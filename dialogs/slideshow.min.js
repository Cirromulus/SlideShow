function removeDomainFromUrl(e){return e.replace(/^https?:\/\/[^\/]+/i,"")}function var_dump(e,t){var i="";t||(t=0);for(var a="",n=0;t+1>n;n++)a+="    ";if("object"==typeof e)for(var s in e){var r=e[s];"object"==typeof r?(i+=a+"'"+s+"' ...\n",i+=var_dump(r,t+1)):i+=a+"'"+s+"' => \""+r+'"\n'}else i="===>"+e+"<===("+typeof e+")";return i}var IMG_PARAM={URL:0,TITLE:1,ALT:2,WIDTH:3,HEIGHT:4},pluginPath=removeDomainFromUrl(CKEDITOR.plugins.get("slideshow").path),BASE_PATH=removeDomainFromUrl(CKEDITOR.basePath),SCRIPT_JQUERY=pluginPath+"3rdParty/jquery.min.js",SCRIPT_ADDGAL=pluginPath+"3rdParty/ad-gallery/jquery.ad-gallery.min.js",CSS_ADDGAL=pluginPath+"3rdParty/ad-gallery/jquery.ad-gallery.css",SCRIPT_FANCYBOX=pluginPath+"3rdParty/fancybox2/jquery.fancybox.pack.js?v=2.1.5",CSS_FANCYBOX=pluginPath+"3rdParty/fancybox2/jquery.fancybox.css?v=2.1.5",listItem=function(e){return e.type==CKEDITOR.NODE_ELEMENT&&e.is("li")},ULItem=function(e){return e.type==CKEDITOR.NODE_ELEMENT&&e.is("ul")},iFrameItem=function(e){return e.type==CKEDITOR.NODE_ELEMENT&&e.is("iframe")};Array.prototype.pushUnique=function(e){for(var t=0;t<this.length;t++)if(this[t][0]==e[0])return-1;return this.push(e),this.length-1},Array.prototype.updateVal=function(e,t){for(var i=0;i<this.length;i++)if(this[i][0]==e)return this[i]=[e,t],!0;return this[i]=[e,t],!1},Array.prototype.getVal=function(e){for(var t=0;t<this.length;t++)if(this[t][0]==e)return this[t][1];return null},CKEDITOR.dialog.add("slideshowDialog",function(e){function t(e,t,i,a,n){e=l(e);var s;return s=a?a.createElement("OPTION"):document.createElement("OPTION"),e&&s&&"option"==s.getName()?(CKEDITOR.env.ie?(isNaN(parseInt(n,10))?e.$.options.add(s.$):e.$.options.add(s.$,n),s.$.innerHTML=t.length>0?t:"",s.$.value=i):(null!==n&&n<e.getChildCount()?e.getChild(0>n?0:n).insertBeforeMe(s):e.append(s),s.setText(t.length>0?t:""),s.setValue(i)),s):!1}function i(e,t,i,a){if(e=l(e),0>t)return!1;var n=e.getChild(t);return n.setText(i),n.setValue(a),n}function a(e){for(e=l(e);e.getChild(0)&&e.getChild(0).remove(););}function n(e,a,n,o){e=l(e);var d=s(e);if(0>d)return!1;var c=d+a;if(c=0>c?0:c,c=c>=e.getChildCount()?e.getChildCount()-1:c,d==c)return!1;var h=/(^IMG_\d+)/,m=e.getChild(c),g=m.getText(),u=m.getValue();g=g.replace(h,"IMG_"+d),i(e,c,g,u),m=e.getChild(d),g=m.getText(),u=m.getValue(),m.remove(),g=g.replace(h,"IMG_"+c),m=t(e,g,u,n?n:null,c),r(e,c);var p=o.imagesList[d],f=o.imagesList[c];return o.imagesList[d]=f,o.imagesList[c]=p,m}function s(e){return e=l(e),e?e.$.selectedIndex:-1}function r(e,t){if(e=l(e),0>t)return null;var i=e.getChildren().count();return e.$.selectedIndex=t>=i?i-1:t,e}function l(e){return e&&e.domId&&e.getInputElement().$?e.getInputElement():e&&e.$?e:!1}function o(e){if(1!=e.openCloseStep){var t=e.getContentElement("slideshowinfoid","framepreviewid");t.isVisible()?v(e):g(e)}}function d(e){var t=e.getDialog();e=l(e);for(var i=0,a=0;a<e.getChildren().count();a++){var n=e.getChild(a);if(n.$.selected){selectefItem=n,i=a;break}}r(e,i),o(t)}function c(e){var t=e.getContentElement("slideshowinfoid","imglistitemsid");return s(t)}function h(e){var t=BASE_PATH+"plugins/slideshow/icons/placeholder.png";if(1==e.imagesList.length&&e.imagesList[0][IMG_PARAM.URL]==t){var i=e.getContentElement("slideshowinfoid","imglistitemsid");i=l(i);var a=0;e.imagesList.splice(a,1),i.getChild(a).remove()}}function m(e){h(e);var i=e.previewImage,a=i.$.src,n=i.$.width/i.$.height,s=50,l=50;n>1?l/=n:s*=n;var d=e.imagesList.pushUnique([a,"","",s.toFixed(0),l.toFixed(0)]);d>=0&&(oOption=t(combo,"IMG_"+d+" : "+a.substring(a.lastIndexOf("/")+1),a,e.getParentEditor().document),r(combo,d),o(e))}function g(e){var t=e.getContentElement("slideshowinfoid","imglistitemsid"),i=s(t),a=e.imagesList[i];t=e.getContentElement("slideshowinfoid","imgtitleid"),t=l(t),t.setValue(a[1]),t=e.getContentElement("slideshowinfoid","imgdescid"),t=l(t),t.setValue(a[2]),t=e.getContentElement("slideshowinfoid","imgpreviewid"),t=l(t);var n='<div style="text-align:center;"> <img src="'+a[0]+'" title="'+a[1]+'" alt="'+a[2]+'" style=" max-height: 200px;  max-width: 350px;"> </div>';t.setHtml(n);var r=e.getContentElement("slideshowinfoid","framepreviewid"),o=e.getContentElement("slideshowinfoid","imgparamsid");r=l(r),r.hide(),o=l(o),o.show()}function u(e){var i=e.getContentElement("slideshowinfoid","imglistitemsid");i=l(i);for(var a=!1,n=i.getChildren().count()-1;n>=0;n--)i.getChild(n).$.selected&&(e.imagesList.splice(n,1),i.getChild(n).remove(),a=!0);if(a){if(0==e.imagesList.length){var s=BASE_PATH+"plugins/slideshow/icons/placeholder.png";oOption=t(i,"IMG_0 : "+s.substring(s.lastIndexOf("/")+1),s,e.getParentEditor().document),e.imagesList.pushUnique([s,S.imgTitle,S.imgDesc,"50","50"])}r(i,0),o(e)}}function p(e,t){var i=e.getContentElement("slideshowinfoid","imglistitemsid");i=l(i);var a=s(i);1!=i.getChildren().count()&&(-1!=t||0!=a)&&(1!=t||a!=i.getChildren().count()-1)&&(n(i,t,e.getParentEditor().document,e),w(e))}function f(e,t){e.imagesList[c(e)][IMG_PARAM.TITLE]=t,g(e)}function b(e,t){e.imagesList[c(e)][IMG_PARAM.ALT]=t,g(e)}function v(e){var t=e.getContentElement("slideshowinfoid","framepreviewid"),i=e.getContentElement("slideshowinfoid","imgparamsid");i=l(i),i.hide(),t=l(t),t.show(),w(e)}function y(e,t){e.open(),e.writeln(t),e.close()}function w(e){var t=436,i=300;if(1==e.params.getVal("showthumbid")?i-=120:1==e.params.getVal("showcontrolid")&&(i-=30),0!=e.imagesList.length){var a=e.getContentElement("slideshowinfoid","imglistitemsid"),n=s(a);0>n&&(n=0);var a=e.getContentElement("slideshowinfoid","framepreviewid"),r="";r+="<head>",r+='<script src="'+SCRIPT_JQUERY+'" type="text/javascript"></script>',r+='<script type="text/javascript" src="'+SCRIPT_ADDGAL+'"></script>',r+='<link rel="stylesheet" type="text/css" href="'+CSS_ADDGAL+'" />',1==e.params.getVal("openOnClickId")&&(r+='<link rel="stylesheet" type="text/css" href="'+CSS_FANCYBOX+'" />',r+='<script type="text/javascript" src="'+SCRIPT_FANCYBOX+'"></script>',r+='<script type="text/javascript">',r+=L(e),r+="</script>"),r+='<script type="text/javascript">',r+=T(e,n,t,i),r+="</script>",r+="</head>",r+="<body>";var o=_(e);r+=o.getOuterHtml(),r+="</body>",r+="",a=l(a);var d=a.getFirst(iFrameItem);d&&d.remove();var c=null,h=t+60,m=i;1==e.params.getVal("showthumbid")?m+=120:1==e.params.getVal("showcontrolid")&&(m+=30);var g=CKEDITOR.dom.element.createFromHtml('<iframe style="width:'+h+"px;height:"+m+'px;background:azure; " class="cke_pasteframe" frameborder="10"  allowTransparency="false" role="region" scrolling="no"></iframe>');g.setAttribute("name","totoFrame"),g.setAttribute("id","totoFrame"),g.on("load",function(){null==c&&(c=this.$,c.contentDocument?iframedoc=c.contentDocument:c.contentWindow&&(iframedoc=c.contentWindow.document),iframedoc?y(iframedoc,r):alert("Cannot inject dynamic contents into iframe."))}),a.append(g)}}function C(e,i){var a,n,s,l,d,c=i.$.getElementsByTagName("img");for(combo=e.getContentElement("slideshowinfoid","imglistitemsid"),a=0;a<c.length;a++){n=c[a],s=n.src,l=n.width,0==l&&(l=n.naturalWidth),0==l?(l=50,d=50):(d=n.height,0==d&&(d=n.naturalHeight),0==d&&(l=50,d=50));var h=l/d,m=50,g=50;h>1?g/=h:m*=h;var u=e.imagesList.pushUnique([s,n.title,n.alt,m,g]);u>=0&&(oOption=t(combo,"IMG_"+u+" : "+s.substring(s.lastIndexOf("/")+1),s,e.getParentEditor().document))}r(combo,0),o(e)}function x(e){combo=e.getContentElement("slideshowinfoid","imglistitemsid");var i=BASE_PATH+"plugins/slideshow/icons/placeholder.png";oOption=t(combo,"IMG_0 : "+i.substring(i.lastIndexOf("/")+1),i,e.getParentEditor().document),e.imagesList.pushUnique([i,S.imgTitle,S.imgDesc,"50","50"]),r(combo,0),o(e)}function I(){var e=this.getDialog();if(e.newSlideShowMode)switch(e.slideshowDOM.setAttribute("data-"+this.id,this.getValue()),this.type){case"checkbox":break;case"text":break;case"select":}else switch(this.type){case"checkbox":this.setValue("true"==e.slideshowDOM.getAttribute("data-"+this.id));break;case"text":this.setValue(e.slideshowDOM.getAttribute("data-"+this.id));break;case"select":this.setValue(e.slideshowDOM.getAttribute("data-"+this.id))}}function A(){var e=this.getDialog();switch(e.params.updateVal(this.id,this.getValue()),this.type){case"checkbox":break;case"text":break;case"select":}o(e)}function E(e){e.previewImage&&(e.previewImage.removeListener("load",R),e.previewImage.removeListener("error",V),e.previewImage.removeListener("abort",V),e.previewImage.remove(),e.previewImage=null),e.imagesList=null,e.params=null,e.slideshowDOM=null,combo=e.getContentElement("slideshowinfoid","imglistitemsid"),a(combo),e.openCloseStep=!1}function D(e){for(var t="";t.length<e;)t+=Math.random().toString(36).substring(2);return t.substring(0,e)}function O(e,t){var i=t.getElementsByTag("ul");return null==i?null:1==i.count()?i.getItem(0):null}function T(e,t,i,a){var n=e.params.getVal("slideshowid"),s="ad-gallery_"+n,r="(function($) {",l="";r+="$(function() {",0==a&&(a=e.params.getVal("pictheightid")),0==i&&(i="false"),0==e.params.getVal("showtitleid")&&(l=",  hooks: { displayDescription: function(image) {}}");var o="loader_image: '"+pluginPath+"3rdParty/ad-gallery/loader.gif', width:"+i+", height:"+a+", start_at_index: "+t+", animation_speed: "+e.params.getVal("animspeedid")+l+", update_window_hash: false, effect: '"+e.params.getVal("transitiontypeid")+"',",d=" slideshow: { enable: true, autostart: "+e.params.getVal("autostartid")+", start_label: '"+S.labelStart+"', stop_label: '"+S.labelStop+"', speed: "+1e3*e.params.getVal("speedid")+",},";return r+="   var galleries = $('#"+s+"').adGallery({"+o+d+"});",r+="});",r+="})(jQuery);"}function L(e){var t=e.params.getVal("slideshowid"),i="ad-gallery_"+t,a="(function($) {";return a+="$(function() {",a+='$("#'+i+'").on("click",".ad-image",function(){',a+='var imgObj =$(this).find("img");',a+='var isrc=imgObj.attr("src");',a+="var ititle=null;",a+="var idesc=null;",a+="var iname=isrc.split('/');",a+="iname=iname[iname.length-1];",a+='var imgdescid=$(this).find(".ad-image-description");',a+="if(imgdescid){",a+='ititle=$(this).find(".ad-description-title");',a+="if(ititle)ititle=ititle.text();",a+="if(ititle!='')ititle='<big>'+ititle+'</big>';",a+='idesc=$(this).find("span");',a+="if(idesc)idesc=idesc.text();",a+="if(idesc!=''){",a+="if(ititle!='')ititle=ititle+'<br>';",a+="idesc='<i>'+idesc+'</i>';",a+="}",a+="}",a+="$.fancybox.open({",a+="href:isrc,",a+="beforeLoad:function(){",a+="this.title=ititle+idesc;",a+="},",a+="});",a+="});",a+="});",a+="})(jQuery);"}function k(e,t){for(var i=0;i<e.imagesList.length;i++){var a=t.append("li");a.setAttribute("contenteditable","false"),aObj=a.append("a"),aObj.setAttribute("href",removeDomainFromUrl(e.imagesList[i][IMG_PARAM.URL])),aObj.setAttribute("contenteditable","false"),newImgDOM=aObj.append("img"),newImgDOM.setAttribute("src",removeDomainFromUrl(e.imagesList[i][IMG_PARAM.URL])),newImgDOM.setAttribute("title",e.imagesList[i][IMG_PARAM.TITLE]),newImgDOM.setAttribute("alt",e.imagesList[i][IMG_PARAM.ALT]),newImgDOM.setAttribute("contenteditable","false"),newImgDOM.setAttribute("width",e.imagesList[i][IMG_PARAM.WIDTH]),newImgDOM.setAttribute("height",e.imagesList[i][IMG_PARAM.HEIGHT])}}function _(t){var i=t.params.getVal("slideshowid"),a="ad-gallery_"+i,n="display: block;",s="display: block;";0==t.params.getVal("showthumbid")&&(n="display: none;"),0==t.params.getVal("showcontrolid")&&(s="visibility: hidden;");var r=e.document.createElement("div");r.setAttribute("id",i),r.setAttribute("class","slideshowPlugin"),r.setAttribute("contenteditable","false");var l=r.append("div");l.setAttribute("class","ad-gallery"),l.setAttribute("contenteditable","false"),l.setAttribute("id",a);var o=l.append("div");o.setAttribute("class","ad-image-wrapper"),o.setAttribute("contenteditable","false");var d=l.append("div");d.setAttribute("class","ad-controls"),d.setAttribute("contenteditable","false"),d.setAttribute("style",s);var c=l.append("div");c.setAttribute("class","ad-nav"),c.setAttribute("style",n),c.setAttribute("contenteditable","false");var h=c.append("div");h.setAttribute("class","ad-thumbs"),h.setAttribute("contenteditable","false");var m=h.append("ul");return m.setAttribute("class","ad-thumb-list"),m.setAttribute("contenteditable","false"),k(t,m),r}function M(t){var i={},a={};t.openCloseStep=!0,t.commitContent(t);for(var n=_(t),s=0;s<t.params.length;s++)n.data(t.params[s][0],t.params[s][1]);var r=CKEDITOR.document.createElement("script",{attributes:{type:"text/javascript",src:SCRIPT_JQUERY}});n.append(r);var l=CKEDITOR.document.createElement("script",{attributes:{type:"text/javascript",src:SCRIPT_ADDGAL}});if(n.append(l),1==t.params.getVal("openOnClickId")){var o=CKEDITOR.document.createElement("script",{attributes:{type:"text/javascript"}});o.setText("(function($) { $('head').append('<link rel=\"stylesheet\" href=\""+CSS_FANCYBOX+'" type="text/css" />\'); })(jQuery);'),n.append(o);var d=CKEDITOR.document.createElement("script",{attributes:{type:"text/javascript",src:SCRIPT_FANCYBOX}});n.append(d);var c=CKEDITOR.document.createElement("script",{attributes:{type:"text/javascript"}});c.setText(L(t)),n.append(c)}var h=CKEDITOR.document.createElement("script",{attributes:{type:"text/javascript"}});h.setText("(function($) { $('head').append('<link rel=\"stylesheet\" href=\""+CSS_ADDGAL+'" type="text/css" />\'); })(jQuery);'),n.append(h);var m=CKEDITOR.document.createElement("script",{attributes:{type:"text/javascript"}});m.setText(T(t,0,0,0)),n.append(m),t.imagesList.length&&(i.backgroundImage='url("'+t.imagesList[0][IMG_PARAM.URL]+'")'),i.backgroundSize="50%",i.display="block";var g=e.createFakeElement(n,"cke_slideShow","slideShow",!1);return g.setAttributes(a),g.setStyles(i),t.fakeImage?(g.replace(t.fakeImage),e.getSelection().selectElement(g)):e.insertElement(g),E(t),t.hide(),!0}var S=e.lang.slideshow,R=function(){var e=this.previewImage;e.removeListener("load",R),e.removeListener("error",V),e.removeListener("abort",V),m(this)},V=function(){var e=this.previewImage;e.removeListener("load",R),e.removeListener("error",V),e.removeListener("abort",V)},P=function(e){return"cke_"+D(8)+"_"+e};return{title:S.dialogTitle,width:500,height:600,resizable:CKEDITOR.DIALOG_RESIZE_NONE,buttons:[CKEDITOR.dialog.okButton(e,{label:"OkCK",style:"display:none;"}),CKEDITOR.dialog.cancelButton,{id:"myokbtnid",type:"button",label:"OK",title:"Button description",style:"color:white;background:blue;",accessKey:"C",disabled:!1,onClick:function(){M(this.getDialog())}}],contents:[{id:"slideshowinfoid",label:"Basic Settings",align:"center",elements:[{type:"text",id:"id",style:"display:none;",onLoad:function(){this.getInputElement().setAttribute("readOnly",!0)}},{type:"text",id:"txturlid",style:"display:none;",label:S.imgList,onChange:function(){var e=this.getDialog(),t=this.getValue();if(t.length>0){var i=e.previewImage;i.on("load",R,e),i.on("error",V,e),i.on("abort",V,e),i.setAttribute("src",t)}}},{type:"button",id:"browse",hidden:"true",style:"display:inline-block;margin-top:0px;",filebrowser:{action:"Browse",target:"slideshowinfoid:txturlid",url:e.config.filebrowserImageBrowseUrl||e.config.filebrowserBrowseUrl},label:S.imgAdd},{type:"vbox",align:"center",children:[{type:"html",align:"center",id:"framepreviewtitleid",style:"font-family: Amaranth; color: #1E66EB;	font-size: 20px; font-weight: bold;",html:S.previewMode},{type:"html",id:"framepreviewid",align:"center",style:"width:500px;height:320px",html:""},{type:"hbox",id:"imgparamsid",style:"display:none;width:500px;",height:"325px",children:[{type:"vbox",align:"center",width:"400px",children:[{type:"text",id:"imgtitleid",label:S.imgTitle,onChange:function(){f(this.getDialog(),this.getValue())},onBlur:function(){f(this.getDialog(),this.getValue())}},{type:"text",id:"imgdescid",label:S.imgDesc,onChange:function(){b(this.getDialog(),this.getValue())},onBlur:function(){b(this.getDialog(),this.getValue())}},{type:"html",id:"imgpreviewid",style:"width:400px;height:200px;",html:"<div>xx</div>"}]}]},{type:"hbox",align:"center",height:110,widths:["25%","50%"],children:[{type:"vbox",children:[{type:"checkbox",id:"autostartid",label:S.autoStart,"default":"checked",style:"margin-top:15px;",onChange:A,commit:A,setup:I},{type:"checkbox",id:"showtitleid",label:S.showTitle,"default":"checked",onChange:A,commit:A,setup:I},{type:"checkbox",id:"showcontrolid",label:S.showControls,"default":"checked",onChange:A,commit:A,setup:I},{type:"checkbox",id:"showthumbid",label:S.showThumbs,"default":"checked",onChange:A,commit:A,setup:I},{type:"checkbox",id:"openOnClickId",label:S.openOnClick,"default":"checked",onChange:A,commit:A,setup:I}]},{type:"select",id:"imglistitemsid",label:S.picturesList,multiple:!1,style:"height:125px;width:250px",items:[],onChange:function(){d(this)}},{type:"vbox",children:[{type:"button",id:"previewbtn",style:"margin-top:15px;margin-left:25px;",label:S.previewMode,onClick:function(){v(this.getDialog())}},{type:"button",id:"removeselectedbtn",style:"margin-left:25px;",label:S.imgDelete,onClick:function(){u(this.getDialog())}},{type:"button",id:"editselectedbtn",style:"margin-left:25px;",label:S.imgEdit,onClick:function(){g(this.getDialog())}},{type:"hbox",children:[{type:"button",id:"upselectedbtn",style:"width:32px; margin-left:25px;",label:S.arrowUp,onClick:function(){p(this.getDialog(),-1)}},{type:"button",id:"downselectedbtn",style:"width:32px;",label:S.arrowDown,onClick:function(){p(this.getDialog(),1)}}]}]}]},{type:"hbox",children:[{type:"text",id:"pictheightid",label:S.pictHeight,maxLength:3,style:"width:100px;","default":"300",onChange:function(){var e=/^\d+$/;0==e.test(this.getValue())&&this.setValue(300),this.getDialog().params.updateVal(this.id,this.getValue()),o(this.getDialog())},commit:A,setup:I},{type:"text",id:"speedid",label:S.displayTime,maxLength:3,style:"width:100px;","default":"5",onChange:function(){var e=/^\d+$/;0==e.test(this.getValue())&&this.setValue(5),this.getDialog().params.updateVal(this.id,this.getValue()),o(this.getDialog())},commit:A,setup:I},{type:"text",id:"animspeedid",label:S.transitionTime,style:"width:100px;",maxLength:4,"default":"500",onChange:function(){var e=/^\d+$/;0==e.test(this.getValue())&&this.setValue(500),this.getDialog().params.updateVal(this.id,this.getValue()),o(this.getDialog())},commit:A,setup:I},{type:"select",id:"transitiontypeid",label:S.transition,items:[[S.tr1,"none"],[S.tr2,"resize"],[S.tr3,"slide-vert"],[S.tr4,"slide-hori"],[S.tr5,"fade"]],"default":"resize",style:"width:100px;",commit:A,setup:I,onChange:A}]}]}]}],onLoad:function(){},onShow:function(){this.dialog=this,this.slideshowDOM=null,this.openCloseStep=!0,this.fakeImage=null;var t=null;this.imagesList=new Array,this.params=new Array,this.previewImage=e.document.createElement("img"),this.okRefresh=!0;var i=this.getSelectedElement();if(i&&i.data("cke-real-element-type")&&"slideShow"==i.data("cke-real-element-type")&&(this.fakeImage=i,t=e.restoreRealElement(i)),t){this.slideshowDOM=t;var a=O(this,t);if(null==a)return alert("BIG Problem slideShowContainer !!"),!1;var n=t.getAttribute("id");if(null==n)return alert("BIG Problem slideshowid !!"),!1;this.params.push(["slideshowid",n]),C(this,a);var s=t.$.dataset;for(param in s)this.params.push([param,s[param]]);this.setupContent(this,!0),this.newSlideShowMode=!1}else this.params.push(["slideshowid",P("slideShow")]),x(this),this.commitContent(this);this.openCloseStep=!1,v(this)},onOk:function(){return!1},onHide:function(){E(this)}}});